$.fn.wait=function(a,b){return this.each(function(){window.setTimeout(function(a){return function(){b.call(a)}}(this),a)})};var srw=function(){var a,b,c,d,e,f,g={api_base:"https://api.spotify.com/v1",genre_limit:5,fade_delay:50},h={$container:null},i=$("#results-template").html(),j=Handlebars.compile(i),k={},l={};return a=function(){var a=h.$container;l={$container:a,$artist:$(".artist"),$artist_img:$(".artist-img"),$related_artists:$(".related-artists"),$top_related_tracks:$(".top-related-tracks"),$results_container:$(".results"),$search_form:$(".search-form"),$search_btn:$(".js-search"),$query:$(".search-form .form-control"),$message:$(".message"),$loading:$(".loading")}},b=function(a){return $.ajax({url:g.api_base+"/search",data:{q:a,type:"artist",limit:10}}).promise()},e=function(a){return $.ajax({url:g.api_base+"/artists/"+a+"/related-artists"}).promise()},c=function(a){return $.ajax({url:g.api_base+"/artists/"+a+"/top-tracks?country=US"}).promise()},clearResults=function(){l.$message.empty(),l.$top_related_tracks.empty()},displayTracks=function(a,b){var c,e=[],f=a.length;for(c=0;f>c;c++)e.push(a[c][0].tracks[0]),e[c].genres=b[c];l.$loading.hide(),l.$top_related_tracks.append(j(e)).find(".track").each(function(a){var b=$(this);b.wait(a++*g.fade_delay,function(){b.addClass("bounceInUp")})}),$(".js-new-search").on("click",function(){var a=$(this).data("artist-name");l.$query.val(a),d(a)})},d=function(a){l.$loading.show(),l.$artist.text(a);var d=b(a);d.done(function(b){var d;if(clearResults(),k[a])displayTracks(k[a],k[a].genres);else if(b.artists.items.length>0){d=b.artists.items[0].id;var f=e(d);f.done(function(b){var d,e=[],f=b.artists,g=f.length,h=(f.genres,[]),i=[];for(d=0;g>d;d++)e.push(c(f[d].id)),h.push(b.artists[d].genres);$.when.apply($,e).done(function(){i=$.grep(arguments,function(a,b){return 0==a[0].tracks.length?(h.splice(b,1),!1):!0}),displayTracks(i,h),k[a]=i,k[a].genres=h})})}})},f=function(b){h.$container=b,a(),l.$loading.hide(),l.$search_btn.on("click",function(a){a.preventDefault();var b=l.$query.val();d(b)}),Handlebars.registerHelper("formatDuration",function(a){var b=Math.floor(a/6e4),c=(a%6e4/1e3).toFixed(0);return b+":"+(10>c?"0":"")+c})},{initModule:f}}();$(function(){srw.initModule($(".srw"))});